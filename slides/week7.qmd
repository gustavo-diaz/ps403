---
format: 
  revealjs:
    slide-number: false
    progress: false
    chalkboard: true
    code-overflow: wrap
    code-line-numbers: false
---


```{r setup, include=FALSE}
# Global options for the rendering behavior of all subsequent code chunks
knitr::opts_chunk$set(echo = TRUE, 
                      warning = FALSE,
                      message = FALSE,
                      fig.pos = "center")

library(tidyverse)
library(tinytable)

# tinytable options
options(tinytable_html_mathjax = TRUE)
```

## Identification

::: incremental
- A model is **identifiable** if it is *theoretically* possible to learn its true values

- **Example:** If we can credibly approximate $E(X)$ with the sample mean, then we can say $E(X)$ is *identified*

- **Validity:** An estimator is *valid* if we believe that it measures what it claims to measure

- A *statistical functional* is **point-identified** if it has only one value that is compatible with the CDF of the unobservable random vector of interest (given assumptions)

:::

## Missing data problem

:::: {.columns}

::: {.column width="50%"}

```{r, echo = FALSE}
tab0 = tribble(
  ~Unit, ~`$Y_i^*$`, ~`$R_i$`, ~`$Y_i$`,
  1, 1, 1, 1,
  2, -99, 0, 0, 
  3, 1, 1, 1,
  4, 0, 1, 0,
  5, 1, 1, 1,
  6, -99, 0, 0
)

tt(tab0) %>% 
  style_tt(i = c(2, 6),
           j = 2,
           color = "purple") %>% 
  style_tt(j = 4,
           color = "gray")
```

:::
::::

## Missing data problem

:::: {.columns}

::: {.column width="50%"}

```{r, echo = FALSE}
tt(tab0) %>% 
  style_tt(i = c(2, 6),
           j = 2,
           color = "purple") %>% 
  style_tt(j = 4,
           color = "gray")
```

:::

::: {.column width="50%"}

**Stable outcomes framework**

::: incremental
- $Y_i$: True outcome (unobserved)

- $R_i$: Recorded (1) or missing (0)

- $Y_i^*$: Observed outcome

- $Y_i^* = Y_i R_i + (-99) (1-R_i)$

- [$E[Y_i] = 3/6$]{style="color:gray;"}; $E[Y_i^*] = 3/4$
:::


:::

::::

. . .

**Challenge:** [$E[Y_i]$]{style="color:gray;"} is **not** *point-identified*

## What can we do?

1. Make minimal assumptions

2. Make heroic assumptions


## Minimal assumption: $Y_i$ is *bounded*


```{r, echo = FALSE}
tab1 = tribble(
  ~Unit, ~`$Y_i^*$`, ~`$R_i$`,
  1, 1, 1,
  2, -99, 0,
  3, 1, 1,
  4, 0, 1,
  5, 1, 1,
  6, -99, 0
)

tt(tab1) %>% 
  style_tt(i = c(2, 6),
           j = 2,
           color = "purple") 
```

. . .

Plug-in worst case scenario to find *lower* and *upper* bound

## Minimal assumption: $Y_i$ is *bounded*


```{r, echo = FALSE}
tab2 = tribble(
  ~Unit, ~`$Y_i^*$`, ~`$R_i$`, ~`$Y_i^L$`, ~`$Y_i^U$`,
  1, 1, 1, 1, 1, 
  2, -99, 0, 0, 1,
  3, 1, 1, 1, 1,
  4, 0, 1, 0, 0,
  5, 1, 1, 1, 1,
  6, -99, 0, 0, 1
)

tt(tab2) %>% 
  style_tt(i = c(2, 6),
           j = 2,
           color = "purple") %>% 
  style_tt(
    i = 1:6,
    j = 4:5,
    color = "white"
  )
```

Plug-in worst case scenario to find *lower* and *upper* bound

## Minimal assumption: $Y_i$ is *bounded*


```{r, echo = FALSE}
tt(tab2) %>% 
  style_tt(i = c(2, 6),
           j = c(2, 4),
           color = "purple") %>% 
  style_tt(
    i = 1:6,
    j = 5,
    color = "white"
  )
```

Plug-in worst case scenario to find *lower* and *upper* bound

## Minimal assumption: $Y_i$ is *bounded*


```{r, echo = FALSE}
tt(tab2) %>% 
  style_tt(i = c(2, 6),
           j = c(2, 4, 5),
           color = "purple")
```

Plug-in worst case scenario to find *lower* and *upper* bound

## Minimal assumption: $Y_i$ is *bounded*


```{r, echo = FALSE}
tt(tab2) %>% 
  style_tt(i = c(2, 6),
           j = c(2, 4, 5),
           color = "purple")
```

**Sharp bounds:** $\widehat E[Y_i] = [\frac{3}{6}, \frac{5}{6}]$

## More heroic assumptions


::: incremental
- **Baseline:** Missing not at at random (MNAR/NMAR)

- **MCAR:** Missing completely at random

- **MAR:** Missing at random *once we condition on covariates* (aka *ignorability*)
:::

## MCAR

```{r, echo = FALSE}

tt(tab1) %>% 
  style_tt(i = c(2, 6),
           j = 2,
           color = "purple") 
```

. . .

We assume the *distribution of outcomes is the same* for observed and unobserved

## MCAR

```{r, echo = FALSE}

tt(tab1) %>% 
  style_tt(i = c(2, 6),
           j = 2,
           color = "purple") 
```

Which is equivalent to imputing missing obs with the sample mean


## MCAR

```{r, echo = FALSE}
tab3 = tribble(
  ~Unit, ~`$Y_i^*$`, ~`$R_i$`, ~`$Y_i$`,
  1, 1, 1, "1",
  2, -99, 0, "$\\widehat E[Y_i] = 3/4$",
  3, 1, 1, "1",
  4, 0, 1, "0",
  5, 1, 1, "1",
  6, -99, 0, "$\\widehat E[Y_i] = 3/4$"
)


tt(tab3) %>% 
  style_tt(i = c(2, 6),
           j = c(2, 4),
           color = "purple")
```

Which is equivalent to imputing missing obs with the sample mean

## MAR

```{r, echo = FALSE}

tt(tab1) %>% 
  style_tt(i = c(2, 6),
           j = 2,
           color = "purple") 
```

. . .

We assume *conditional independence*

## MAR

```{r, echo = FALSE}

tt(tab1) %>% 
  style_tt(i = c(2, 6),
           j = 2,
           color = "purple") 
```

Imagine we now observe covariate $X_i$


## MAR

```{r, echo = FALSE}
tab4 = tribble(
  ~Unit, ~`$Y_i^*$`, ~`$R_i$`, ~`$X_i$`,
  1, 1, 1, 0,
  2, -99, 0, 0,
  3, 1, 1, 0,
  4, 0, 1, 0,
  5, 1, 1, 1,
  6, -99, 0, 1
)

tt(tab4) %>% 
  style_tt(i = c(2, 6),
           j = 2,
           color = "purple") 
```

Imagine we now observe covariate $X_i$

## MAR

```{r, echo = FALSE}
tt(tab4) %>% 
  style_tt(i = c(2, 6),
           j = 2,
           color = "purple") 
```

MAR lets us impute the sample mean of units with the same covariate values

## MAR

```{r, echo = FALSE}
tab5 = tribble(
  ~Unit, ~`$Y_i^*$`, ~`$R_i$`, ~`$X_i$`, ~`$Y_i$`,
  1, 1, 1, 0, "1",
  2, -99, 0, 0, "$\\widehat E[Y_i|X_i=0] = 2/3$",
  3, 1, 1, 0, "1",
  4, 0, 1, 0, "0",
  5, 1, 1, 1, "1",
  6, -99, 0, 1, "$\\widehat E[Y_i|X_i=1] = 1$"
)

tt(tab5) %>% 
  style_tt(i = c(2, 6),
           j = c(2, 5),
           color = "purple") 
```

We can impute the sample mean of units with the same covariate values

## MAR with multiple covariates

```{r, echo = FALSE}

tt(tab1) %>% 
  style_tt(i = c(2, 6),
           j = 2,
           color = "purple") 
```

Imagine we observe covariates $X_{1i}$ and $X_{2i}$

## MAR with multiple covariates

```{r, echo = FALSE}
tab6 = tribble(
  ~Unit, ~`$Y_i^*$`, ~`$R_i$`, ~`$X_{1i}$`, ~`$X_{2i}$`,
  1, 1, 1, 0, 3,
  2, -99, 0, 0, 7,
  3, 1, 1, 0, 9,
  4, 0, 1, 0, 5,
  5, 1, 1, 1, 4,
  6, -99, 0, 1, 3
)

tt(tab6) %>% 
  style_tt(i = c(2, 6),
           j = 2,
           color = "purple") 
```

Imagine we observe covariates $X_{1i}$ and $X_{2i}$

